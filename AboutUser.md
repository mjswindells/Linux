# 사용자 데이터베이스
## 쉘(shell)
- 커널과 사용자 프로그램의 중간에 위치하는 명령어 해석기.
- cmd 또는 윈도우탐색기와 유사한 프로그램이라 생각하면 된다.
- 본쉘(bourne shell), C쉘(csh), 콘 쉘(ksh), 배쉬(bash)쉘이 존재한다.

#
#
## /etc/passwd 파일

- 7개의 필드로 구성되어 있음 : 에 의해서 구분

- ex) root : x : 0 : 0 : root : /root : /bin/bash
- 계정:패스워드:UID:GID:계정 COMMENT:사용자계정 디렉토리:사용자로그인 쉘

1. 2번째 필드의 패스워드는 /etc/shadow 파일에 암호화되어 있음

2. UID가 0이면 슈퍼유저 : 최상위 권한을 가진 계정
3. 슈퍼유저는 폴더,파일접근/수정가능, 자신 또는 다른 계정으로 실행중인 프로세스 중지 가능
## /etc/shadow 파일
- root계정을 통해서만 파일을 볼 수 있다.
- 암호화된 패스워드 필드 외에도 패스워드 유효시한 및 계정 사용여부에 대한 정보도 포함

9개의 필드를 가진다
- ex)root : $1$nnhTqCCE$AGwXjd6/wcyzXoR3uKdUs/ : 14319 : 0 : 99999 : 7 : : :

- 사용자명 : 패스워드 : 최종수정일 : 변경 최소일 : 변경 최대일 : 만료 경고시간 : 파기시간(패스워드 파기 후 계정 비활성 기간) : 계정 만료기간 : 예약필드

2번째 필드의 패스워드는 위와같이 해쉬코드로 되어있다.(보안)
나머지 시간들은 유닉스타임으로 최초 개방자들이 정한 시간

## /etc/group 파일
- 각 사용자는 적어도 하나의 그룹에 속해있다.
- ex) root : x : 0 : root
- 그룹이름 : 패스워드 : GID : 쉼표로 분리된 소속 사용자들
#
# 사용자 관리도구
- users : 현재 시스템에 로그인한 사용자 계정 조회
- finger [uswername]: 사용자 정보 구하기
1. users 보다 finger가 더 자세한 정보를 출력
2. username 생략시 시스템에 로그인한 모든 사용자 정보 출력
3. 자세한 정보를 보기위해서 root계정으로 로그인 필요
- useradd [옵션] [username] :사용자 추가
1. 옵션 : -d [HOME_DIR] : 사용자의 홈 디렉토리 직접 지정
2. 옵션 : -m 홈 디렉토리 자동생성
3. 옵션 : -D ex)useradd -D : 계정생성 기본설정파일 출력
- passwd [username] : 계정 암호 지정 및 변경
1. 사용자 정보와 패스워드는 통상 /etc/passwd 파일에 저장되어 사용자가 로그인시 항상 인증 절차를 걸친다
2. 패스워드가 x인 경우 shadow 패스워드로 'etc/shadow'파일에 암호화되어 저장된다
- adduser [username] : useradd와 동일하게 사용자 추가
1. useradd와의 차이점은 디폴드로 설정을 하게 만든다 즉 adduser는 커스터마이징에는 용이하지 않지만 편하다
- usermod [옵션] [username] : 계정 사용자 정보 변경
1. 옵션 : -c "comment" : 설명필드의 내용 변경
2. 옵션 : -d HOME_DIR : 홈 디렉토리 변경
- userdel [옵션] [username] : 계정삭제
1. 옵션 : -f 파일소유자와 관계없이 강제삭제
2. 옵션 : -r 홈 디렉토리와 메일 저장소 모두 삭제

- groupadd [groupname] : /etc/group 파일에 그룹추가
- groupdel [groupname] : /etc/group 파일에 그룹삭제
- groupmod [옵션] [그룹네임] : 그룹정보변경
1. 옵션 : -g num : 그룹의 GID를 입력값으로 지정
2. 옵션 : -n name : 그룹 이름변경
#
# umask
- 마스킹의 의미로 지운다고 생각하자
- 새로 만들어지는 파일 및 디렉토리의 디폴드 권한을 지정
- 쉘의 기본적인 umask 값은 0022
- 기본적으로 파일은 실행권한을 갖지 못한다.(디렉토리:777)(파일:666)
 1. 파일에 실행권한이 주어지면 보안에 취약하다 
 2. 파일 : 666의 의미는 rw-rw-rw-로 실행권한이 없다
 
 기본적인 umask 0022를 보자

이 상태에서 디렉토리를 만든다면 777 - 022 = 755 로 rwxr-xr-x 가 되고

파일을 만든다면 666 - 022 = 644로 rw-r--r--가 된다

- umaks 0002 이런식으로 변경가능
- 계정마다 umask는 다르다
- 변경내용을 적용하려면 재로그인

#
# SetUID 와 SetGID

- 프로그램은 파일 소유자 및 그룹의 권한으로 실행된다.
  
EX) root권한 파일을 실행하는 도중에는 root의 권한을 갖는다
- 프로그램에 SetUID를 세팅하려면 지정할 허가권 값의 앞에 4를 붙인다.
- 프로그램에 SetGID를 세팅하려면
지정할 허가권 값의 앞에 2를 붙인다.

ex) chmod 4775 /bin/cat

## SetUID 동작
예시를 통해보자 일반적으로 passwd명령을 보면 /etc/shadow 파일에 접근을 해야만 passwd에 접근할 수 있다.

즉, 일반 사용자는 etc/shadow 파일에 접근이 불가능하다.
하지만 passwd 명령을 상요해 패스워스 설정이 가능하다.

따라서 passwd 파일에는 SetUID 권한이 주어져있으며 파일 소유자가 root이므로 파일이 실행되는 프로세스는 실행시간동안 파일 소유자인 root 권한으로 실행된다

![SetUID](https://user-images.githubusercontent.com/91093119/158982160-27c425b1-8b02-40c5-85de-3952bf5dbda0.jpg)

- SetUID가 root로 설정된 파일 보기
- find / -user root -perm /4000
  
## Sticky bit
스티키비트는 디렉토리에만 주어지는 권한

- 스티키 비트가 부여된 디렉토리에 있는 파일은 접근 권한과 상관없
이 파일의 소유자와 관리자만이 파일을 삭제할 수 있다.
- 스티키 비트를 설정하려면 지정할 허가권 값의 앞에 1을 준다.
- EX) chmod 1777 sample
- 스티키비트가 설정되어 있으면 누구나 자유롭게 디렉토리를 사용가능
- 스티키비트가 설정되어 있으면 기타사용자 접근 권한의 실행 부분에 실행권한이 있으면 t 없으면 T로 표기
- ex) rwxrwxr-t
- ex) rw-rwxr-T